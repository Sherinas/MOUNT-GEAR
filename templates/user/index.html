<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ .title }}</title>
<link rel="stylesheet" href="../assets/stl.css">
</head>
<body>
<div class="login-container">
    <div class="login-content">
        <div class="login-content_header">
            <span class="logo">
                <box-icon type='solid' name='landscape' color="#87A922"></box-icon> Land Scape
            </span>
            <h2>Log In</h2>
        </div>
        <div>
            <form class="login-form" action="/login" method="post">
                <input name="email" type="email" placeholder="email" required>
                <input name="password" type="password" placeholder="password" required>
                <input type="submit">
            </form>
            <div class="login-networks">
                <p>Don't have an account? <span><a href="/signup" style="text-decoration: none; color: mediumorchid" >Register</a></span></p>
                <p><span><a href="/recover-Password" id="#" style="text-decoration: none; color: mediumorchid">Forgot Password?</a></span></p>

                {{ if .Error }}
                <div class="text-danger mt-2">{{ .Error }}</div>
                {{ end }}
                <div class="login-or">
                    <hr />
                </div>
                <ul class="login-icons">
                    <li>
                        <a href="/auth/google/login" style="text-decoration: none; color: rgb(247, 246, 248)"><box-icon color="#fff"  type='logo' name='google'></box-icon> Sign in with Google</a>
                    </li>
                    <li>
                        <box-icon color="#fff" type='logo' name='facebook-circle'></box-icon> Sign in with Facebook
                    </li>
                    <li>
                        <box-icon color="#fff" type='logo' name='github'></box-icon> Sign in with GitHub
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="login-footer">
    </div>
</div>



</script>
<script>
    function getState() {
        return Math.random().toString(36).substring(2); // Generate a simple state value
    }

    function onSignIn(googleUser) {
        var id_token = googleUser.getAuthResponse().id_token;
        var state = localStorage.getItem('state'); // Retrieve the state value
        fetch('/auth/google/callback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ token: id_token, state: state })
        }).then(response => {
            if (response.ok) {
                window.location.href = '/';
            } else {
                console.error('Google login failed');
            }
        });
    }

    function initGoogleSignIn() {
        var state = getState();
        localStorage.setItem('state', state); // Store the state value
        gapi.load('auth2', function() {
            gapi.auth2.init({
                client_id: 'YOUR_GOOGLE_CLIENT_ID'
            }).then(function(auth2) {
                document.getElementById('google-login-btn').addEventListener('click', function() {
                    auth2.signIn().then(onSignIn);
                });
            });
        });
    }

    window.onload = initGoogleSignIn;
</script>
<script>
    if (window.history.replaceState) {
        window.history.replaceState(null, null, window.location.href);
    }
</script>
</body>
</html>